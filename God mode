--// FULL IMMORTAL GOD MODE
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local char = player.Character or player.CharacterAdded:Wait()

-- Anti death joints
local function setupCharacter(character)
    local hum = character:WaitForChild("Humanoid")

    -- Không chết khi health = 0
    hum.BreakJointsOnDeath = false

    -- Anti ragdoll
    hum:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
    hum:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
    hum:SetStateEnabled(Enum.HumanoidStateType.Physics, false)

    -- Force đứng dậy nếu bị knock
    hum.StateChanged:Connect(function()
        if hum:GetState() == Enum.HumanoidStateType.Ragdoll then
            hum:ChangeState(Enum.HumanoidStateType.GettingUp)
        end
    end)

    -- Hồi máu khi bị trừ
    hum:GetPropertyChangedSignal("Health"):Connect(function()
        if hum.Health < hum.MaxHealth then
            hum.Health = hum.MaxHealth
        end
    end)

    -- Auto revive nếu chết
    hum.Died:Connect(function()
        wait(0.5)
        if player.Character then
            player.Character:BreakJoints()
            wait()
            player:LoadCharacter()
        end
    end)
end

-- Setup lần đầu
setupCharacter(char)

-- Khi respawn
player.CharacterAdded:Connect(function(newChar)
    char = newChar
    setupCharacter(newChar)
end)

-- Hồi máu liên tục (backup layer)
RunService.RenderStepped:Connect(function()
    if char and char:FindFirstChild("Humanoid") then
        local hum = char.Humanoid
        if hum.Health < hum.MaxHealth then
            hum.Health = hum.MaxHealth
        end
    end
end)

-- Anti reset thủ công
player.CharacterRemoving:Connect(function()
    task.wait(0.2)
    if char then
        player.Character = char
    end
end)