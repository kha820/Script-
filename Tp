-- TP PRO MAX | by Kha

local Players = game:GetService("Players")
local player = Players.LocalPlayer
local hrp
local saved = {}
local minimized = false

-- Fix respawn
local function updateChar(char)
    hrp = char:WaitForChild("HumanoidRootPart")
end
updateChar(player.Character or player.CharacterAdded:Wait())
player.CharacterAdded:Connect(updateChar)

-- GUI
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "TP_PRO_KHA"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0,220,0,340)
frame.Position = UDim2.new(0,50,0,200)
frame.BackgroundColor3 = Color3.fromRGB(20,20,20)
frame.BackgroundTransparency = 0.35
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0

-- Title bar
local titleBar = Instance.new("Frame", frame)
titleBar.Size = UDim2.new(1,0,0,30)
titleBar.BackgroundTransparency = 1

local title = Instance.new("TextLabel", titleBar)
title.Size = UDim2.new(0.6,0,1,0)
title.BackgroundTransparency = 1
title.TextScaled = true
title.RichText = true
title.Text = '<font color="#00ffd5">TP PRO</font> <font color="#ffffff">| by Kha</font>'

-- Minimize
local mini = Instance.new("TextButton", titleBar)
mini.Size = UDim2.new(0.2,0,1,0)
mini.Position = UDim2.new(0.6,0,0,0)
mini.Text = "➖"
mini.TextScaled = true
mini.BackgroundColor3 = Color3.fromRGB(255,200,0)

-- Close
local close = Instance.new("TextButton", titleBar)
close.Size = UDim2.new(0.2,0,1,0)
close.Position = UDim2.new(0.8,0,0,0)
close.Text = "X"
close.TextScaled = true
close.BackgroundColor3 = Color3.fromRGB(255,80,80)

-- Container
local container = Instance.new("Frame", frame)
container.Size = UDim2.new(1,0,1,-30)
container.Position = UDim2.new(0,0,0,30)
container.BackgroundTransparency = 1

-- ===== TP PLAYER BOX =====

local nameBox = Instance.new("TextBox", container)
nameBox.Size = UDim2.new(0.7,0,0,30)
nameBox.PlaceholderText = "Nhập tên player..."
nameBox.Text = ""
nameBox.TextScaled = true
nameBox.BackgroundColor3 = Color3.fromRGB(40,40,40)
nameBox.Position = UDim2.new(0,0,0,0)

local tpBtn = Instance.new("TextButton", container)
tpBtn.Size = UDim2.new(0.3,0,0,30)
tpBtn.Position = UDim2.new(0.7,0,0,0)
tpBtn.Text = "TP"
tpBtn.TextScaled = true
tpBtn.BackgroundColor3 = Color3.fromRGB(0,255,120)

-- Dropdown button
local drop = Instance.new("TextButton", container)
drop.Size = UDim2.new(1,0,0,25)
drop.Position = UDim2.new(0,0,0,35)
drop.Text = "▼ Danh sách người chơi"
drop.TextScaled = true
drop.BackgroundColor3 = Color3.fromRGB(60,60,60)

local listFrame = Instance.new("Frame", container)
listFrame.Size = UDim2.new(1,0,0,100)
listFrame.Position = UDim2.new(0,0,0,60)
listFrame.BackgroundTransparency = 1
listFrame.Visible = false

local layout = Instance.new("UIListLayout", listFrame)

-- Create player button
local function refreshList()
    for _,v in pairs(listFrame:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end

    for _,plr in pairs(Players:GetPlayers()) do
        if plr ~= player then
            local btn = Instance.new("TextButton", listFrame)
            btn.Size = UDim2.new(1,0,0,25)
            btn.Text = plr.Name
            btn.TextScaled = true
            btn.BackgroundColor3 = Color3.fromRGB(80,80,80)

            btn.MouseButton1Click:Connect(function()
                if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                    hrp.CFrame = plr.Character.HumanoidRootPart.CFrame
                end
            end)
        end
    end
end

refreshList()
Players.PlayerAdded:Connect(refreshList)
Players.PlayerRemoving:Connect(refreshList)

drop.MouseButton1Click:Connect(function()
    listFrame.Visible = not listFrame.Visible
end)

-- TP by name
tpBtn.MouseButton1Click:Connect(function()
    local target = Players:FindFirstChild(nameBox.Text)
    if target and target ~= player then
        if target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
            hrp.CFrame = target.Character.HumanoidRootPart.CFrame
        end
    end
end)

-- ===== SLOT TP =====

local startY = 170
for i = 1,5 do
    local y = startY + (i-1)*35

    local set = Instance.new("TextButton", container)
    set.Size = UDim2.new(0.5,0,0,30)
    set.Position = UDim2.new(0,0,0,y)
    set.Text = "SET "..i
    set.BackgroundColor3 = Color3.fromRGB(0,170,255)
    set.TextScaled = true

    local tp = Instance.new("TextButton", container)
    tp.Size = UDim2.new(0.5,0,0,30)
    tp.Position = UDim2.new(0.5,0,0,y)
    tp.Text = "TP "..i
    tp.BackgroundColor3 = Color3.fromRGB(0,255,120)
    tp.TextScaled = true

    set.MouseButton1Click:Connect(function()
        if hrp then saved[i] = hrp.CFrame end
    end)

    tp.MouseButton1Click:Connect(function()
        if saved[i] and hrp then hrp.CFrame = saved[i] end
    end)
end

-- Minimize
mini.MouseButton1Click:Connect(function()
    minimized = not minimized
    container.Visible = not minimized
    frame.Size = minimized and UDim2.new(0,220,0,30) or UDim2.new(0,220,0,340)
    mini.Text = minimized and "➕" or "➖"
end)

-- Close
close.MouseButton1Click:Connect(function()
    gui:Destroy()
end)